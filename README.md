# Воспроизводимый ML-пайплайн с DVC и MLflow

## Цель проекта

Этот проект демонстрирует создание полностью воспроизводимого ML-пайплайна с использованием DVC (Data Version Control) для версионирования данных и моделей, а также MLflow для отслеживания экспериментов. Цель проекта — показать, как организовать ML-разработку так, чтобы любой пользователь мог воспроизвести результаты. Пайплайн автоматически управляет подготовкой данных, обучением модели и логированием метрик и артефактов, обеспечивая полную воспроизводимость благодаря фиксированным значениям random seed и зафиксированным версиям зависимостей.

## Быстрый старт

Следуйте этим шагам для установки и запуска пайплайна:

```bash
# 0. Клонирование репозитория
git clone https://github.com/mipt-bio3/mlops_hw1
cd mlops_hw1

# 1. Установка зависимостей
pip install -r requirements.txt --no-input

# 2. Получение данных, отслеживаемых DVC
dvc pull
# ВНИМАНИЕ! Игнорируйте ошибку "ERROR: failed to pull data from the cloud":
# в данном примере данных хранятся в папке "dvc-storage" (remote = localstorage)
# в реальном проекте DVC-remote должен быть облачным хранилищем

# 3. Запуск полного ML-пайплайна (подготовка данных + обучение модели)
dvc repro

# 4. Запуск MLflow для просмотра результатов экспериментов
mlflow ui

# 5. Открыть браузер и перейти на http://localhost:5000

# 6. Проверка воспроизводимости
verify_reproducibility.sh
```

## Описание пайплайна

Пайплайн состоит из двух основных этапов, определённых в `dvc.yaml`:

**Этап 1: Подготовка данных (Prepare)**

На этом этапе скрипт `src/prepare.py` загружает исходный датасет Iris из файла `data/raw/iris.csv`, выполняет базовую очистку (удаление дубликатов), проверяет пропущенные значения и разделяет данные на обучающее и тестовое подмножества. Разделение выполняется с фиксированным значением `random_state` для обеспечения воспроизводимости. Обработанные данные сохраняются в `data/processed/train.csv` и `data/processed/test.csv`.

**Этап 2: Обучение модели (Train)**

На этом этапе скрипт `src/train.py` загружает обработанные данные из предыдущего этапа, инициализирует модель с параметрами из `params.yaml`, обучает модель на обучающем подмножестве и оценивает её производительность на тестовом подмножестве. Все гиперпараметры логируются в MLflow до начала обучения, а метрики (accuracy, precision, recall, F1-score) логируются после завершения обучения. Обученная модель сохраняется в `model.pkl` и логируется как артефакт в MLflow.

**Воспроизводимость**

Воспроизводимость обеспечивается несколькими механизмами: все зависимости зафиксированы на конкретные версии в `requirements.txt`, все случайные операции используют фиксированный `random_state`, а конфигурация параметров хранится в `params.yaml` и отслеживается DVC как зависимость для обоих этапов пайплайна.

## Запуск MLflow

MLflow используется для отслеживания экспериментов, логирования гиперпараметров, метрик и артефактов модели. Для запуска интерфейса MLflow выполните команду:

```bash
mlflow ui
```

Эта команда запускает локальный веб-сервер MLflow. После запуска команды откройте браузер и перейдите на адрес http://localhost:5000
